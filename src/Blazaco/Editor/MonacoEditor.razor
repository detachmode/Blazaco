@using Microsoft.AspNetCore.Components
@using Microsoft.JSInterop

@if (FullScreen)
{
    <div id="@Model.Id" style="width: 100%; height: 100vh; display: flex;"></div>
}
else
{
    <div id="@Model.Id" style="width: @(Width)px; height: @(Height)px; border: 1px solid #A4A4A4;"></div>
}

@functions {

    [Inject]
    IJSRuntime runtime { get; set; }

    [Parameter]
    Blazaco.Editor.EditorModel Model { get; set; }

    [Parameter]
    int Width { get; set; } = 800;

    [Parameter]
    int Height { get; set; } = 600;

    [Parameter]
    bool FullScreen { get; set; }

    private bool _alreadyRendered = false;

    private Blazaco.Editor.BlazacoJSInterop Interops;

    protected override async Task OnAfterRenderAsync()
    {
        Interops = new Blazaco.Editor.BlazacoJSInterop(runtime, Model);

        if (!_alreadyRendered)
        {

            _alreadyRendered = await Interops.InitializeEditor();
        }
    }

    public async Task<string> GetValue()
    {
        return await Interops.InvokeEditorModelMethod<string>("getValue");
    }

    public async Task SetValue(string newValue)
    {
       await Interops.InvokeEditorModelMethod<bool>("setValue", newValue);
    }

    public async Task SetTheme(string newTheme)
    {
        await Interops.InvokeEditorModelMethod<bool>("setTheme", newTheme);
    }

    public async Task Layout()
    {
        await Interops.InvokeEditorModelMethod<bool>("layout");
    }
    
    public async Task<string> GetLineContent()
    {
        dynamic pos = await Interops.InvokeEditorMethod<object>("getPosition"); 
        //Console.WriteLine(new {foo = "bar"});
       
       
        var lineContent = await Interops.InvokeEditorModelMethod<string>("getLineContent", 1); 

        return lineContent;
        
    }

    public async Task<string> GetSelectedText()
    {
        var res = await Interops.EvalUnsafe(
            "myEditor.editor.getModel().getValueInRange(myEditor.editor.getSelection());");
        return res.ToString();
    }



  //  public async Task RegisterAction(string actionId, string actionLabel, Action callback)
  //  {
  //      await JSRuntime.InvokeEditorMethod<object>(
  //          "Blazaco.Editor.RegisterAction", 
  //          new object[] 
  //              { 
  //                  _editorModel.Id, 
  //                  actionId,
  //                  actionLabel,
  //                  new DotNetObjectRef(new EditorAction(callback)) 
  //              });
  //  }



}